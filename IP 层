二层网络的共性：封装成帧，透明传输，差错检测（比特差错）
二层网络的遗留问题：1，不同网络之间如何通信；2，如果解决可靠传输的问题
IP层只解决第一个问题，可靠传输交给 运输层
IP层尽最大可能传输

网际协议IP, 以及与IP协议配套使用的三个协议：ARP, ICMP, IGMP
网络接口层：物理层+数据链路层
使用中间设备（中间系统/中继系统）进行互连：
网络层：路由器
物理层：转发器（repeater）
数据链路层：交换机，网桥
网桥和路由器混合物：桥路器：brouter
网络层以上的中继系统：网关（gateway）
虚拟互连网络：逻辑互连网络，又称IP网；IP协议使得性能各异网络从用户角度是一个统一的网络
IP数据报在网络层传输，各个设备网络层逻辑上直接通信
IP地址：IP协议定义的地址；路由器的转发是基于IP地址
IP地址分配机构： 互联网名字和数字分配机构ICANN（Internet Corporation for Assigned Names and Numbers）

1, IP地址分类
IPv4（32位）= 网络号net-id（所在网络）+主机号host-id（在所在网络中的编号唯一）；一个IP地址在互联网中唯一
用户使用的：A类：8位+24位（0起始，0-126）；B类：16位+16位（10起始，128-191）；C类：24位+8位（110起始，192-223）
D类：1110+28位，多播地址；E类：1111+28位，以后用
点分十进制：8位一组：例如，128.11.3.31
主机号全0或全1都不用
（全1+全1）255.255.255.255 受限广播（路由器不转发）
net-id+全1：对net-id网络中所有主机广播，路由器有可能转发，直接广播
127.0.0.1：回环地址
IP地址分配机构只分配网络号，主机号由该网络号单位自行分配
路由器根据 主机所连接的网络号转发分组，减少路由表所占存储空间
IP地址：标志一个主机或路由器以及一条链路的接口（网卡）；因此IP地址实际是分配给网卡的，多个网卡就是多个IP地址
主机连接多个网络，则具备多个网络IP地址，网络号不同，这种主机:多归属主机（multihomed host）
一个路由器至少有两个不同的IP地址
一个网络意味着IP地址的网络号是一样的
转发器或网桥连接起来的若干个局域网仍是一个网络
2，划分子网
3，无分类编址方式---构造超网

计算机通信需要使用到 IP地址以及MAC地址，因此这两种地址需要实现一一对应的映射关系，这种映射关系通过ARP协议来实现
MAC地址是实际的硬件地址，是物理层以及数据链路层使用的地址；但是IP地址是虚拟的逻辑地址，是网络层以及以上的层所使用的IP地址。，这个地址是会发生改变的。
如果辨别两个主机是不是在同一个网络当中
1，查看两个主机的IP地址的分类（A类：1-126，8位网络号；B类：128-191，16位网络号； C类：192-223，24位网络号）
不同的网络通过路由器进行连接，因此路由器拥有至少两个以上的网卡，以及IP地址。路由器和路由器之间可以构建一个特殊的没有任何主机的局域网，，但经常情况下，这种网络是不使用的
ARP协议：实现IP地址和MAC地址之间的映射，IP地址解析到IP地址是自动进行的，是对用户透明的
局域网中主机和路由器中有ARP高速缓存，其中存放最近IP地址和MAC地址之间的映射关系
同一局域网中主机A-主机B通信过程：如果ARP高速缓存中有IP-MAC之间的映射关系，直接将MAC帧发送给目标主机
如果没有，进行广播ARP请求分组，由目标主机进行响应。
不同的局域网中的主机通信，需要通过路由器作为ARP代理进行转发分组。不同的局域网中通信，目标IP地址并不发生变化
但是映射的MAC地址分别为源主机局域网中进行分组转发的路由器所在源局域网接口的MAC地址，
第二个局域网中进行分组转发的路由器所在局域网接口的MAC地址。。。。最后才是 真正的目标IP地址和MAC地址之间的映射关系
ARP协议解析的四种场景：主机广播分组，主机响应；主机广播分组，路由器响应；路由器广播分组，主机响应，路由器广播分组，路由器响应

IP数据包的格式：首部+数据
首部：IPv4：20个字节的固定长度，所有IP数据报都必须具备的；以及一些可选字段
           IP版本（4个bit）；首部长度（4个bit，可以代表15个单位长度，一个单位表示4字节，因此首部长度最大60字节，可选字段最大长度是40字节
           区分服务（8个bit）：quality of service：获取更好的服务。只要在使用区分服务（DiffServ）时，该字段才起作用
           总长度(16个bit)：整个IP数据报的长度（首部+数据）：必须不超过MTU
           标识：计数器（16个bit）产生IP数据报的标识,表示第几个IP数据报
           标志（3个bit）：【暂时只有前两个是用的】标志字段最低位（MF,more fragment=1，有更多分片；=0，最后一个分片）
           ；                                   标志字段中间一位DF(Don't fragment,=0,允许分片)
片偏移（13bit，以8个字节位偏移单位，换句话说，一个bit代表8个字节的偏移）：较长分组需要进行分片（DF=0）,后面的分片相对前一个分片的分片，即前一个分片的长度（反过来说，当前分片的长度可以通过下一分片的片偏移字段的值来知道）
      分片不会平均分配，而是按照MTU进行分配，原始数据报的首部复制到其他的分片作为分片的首部。有关字段的值需要进行修改（比如标志字段的值，片偏移字段的值）
      一个分组被分片后，第一个分片的 片偏移字段的值是 0，标志字段的DF位=0，MF=1；第二个分片 的片偏移字段的值 是  前一个分片的长度/8,标志字段的DF位=0，MF=1；第三个    是  前两个 分片的总长/8; 最后一个分片的标志字段的DF位=0，MF=0
      所有分片的标识字段 都相同，因为是来自同一个IP数据报
生存时间（8个bit，TTL, time to live）：表示IP数据报在网络中可通过的路由器的最大值，而不是一个IP数据报在 网络中实际的生存时间
协议（8个bit）：IP数据报的上层协议，是通过什么协议传输到IP层的
首部校验和（16bit）：只检验数据报的首部，不检验数据部分，不采用CRC检验码，采用16位的二进制反码求和算法
源地址和目的地址，分别为32bit
选项字段（1-40个字节）

IP层转发分组流程
路由表中，每一条路由中，最主要的是 目的主机的网络号，下一跳地址（next hop：哪个路由器的哪个接口的IP地址）
特定主机路由：人工（网络管理员）规定下一跳地址
默认路由：减少路由表所占用的空间和搜索路由表所用的时间。目的网络：通过下一跳的默认路由器去往默认目的网络


                                     
